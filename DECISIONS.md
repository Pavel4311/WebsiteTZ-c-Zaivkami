# –ö–ª—é—á–µ–≤—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

## 1. –í—ã–±–æ—Ä —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —Å—Ç–µ–∫–∞

**–†–µ—à–µ–Ω–∏–µ:** TypeScript + Express + Sequelize + SQLite

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**

- **TypeScript** - —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏ –Ω–∞ —ç—Ç–∞–ø–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **Express** - –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –∏ –≥–∏–±–∫–∏–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ API
- **Sequelize ORM** - —É–ø—Ä–æ—â–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å –ë–î, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
- **SQLite** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ –ë–î, –∏–¥–µ–∞–ª–µ–Ω –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**

- Prisma ORM (—Å–ª–æ–∂–Ω–µ–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
- PostgreSQL (—Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞)

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: —Ç—Ä—ë—Ö—Å–ª–æ–π–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

**–†–µ—à–µ–Ω–∏–µ:** Controller ‚Üí Service ‚Üí Model

```
src/
‚îú‚îÄ‚îÄ controllers/   # HTTP-–∑–∞–ø—Ä–æ—Å—ã/–æ—Ç–≤–µ—Ç—ã
‚îú‚îÄ‚îÄ services/      # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ models/        # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îî‚îÄ‚îÄ routes/        # –ú–∞—Ä—à—Ä—É—Ç—ã API
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**

- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** - –∫–∞–∂–¥—ã–π —Å–ª–æ–π —Ä–µ—à–∞–µ—Ç —Å–≤–æ—é –∑–∞–¥–∞—á—É
- **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞ –æ—Ç HTTP
- **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** - —Å–µ—Ä–≤–∏—Å—ã –º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤

**–ü—Ä–∏–º–µ—Ä:**

```typescript
// Controller (HTTP-—Å–ª–æ–π)
export const takeInProgress = async (req: Request, res: Response) => {
  const updatedRequest = await requestService.takeInProgress(
    requestId,
    masterId
  );
  res.status(200).json(updatedRequest);
};

// Service (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
class RequestService {
  async takeInProgress(requestId: number, masterId: number) {
    // –ü—Ä–æ–≤–µ—Ä–∫–∏, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
  }
}
```

---

## 3. –ó–∞—â–∏—Ç–∞ –æ—Ç race condition —á–µ—Ä–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `transaction` + `lock: true` –≤ Sequelize

```typescript
async takeInProgress(requestId: number, masterId: number) {
  const transaction = await sequelize.transaction();

  try {
    const request = await ServiceRequest.findByPk(requestId, {
      transaction,
      lock: true,  // üîí –ü–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
    });

    // –ü—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
    request.status = "in_progress";
    await request.save({ transaction });

    await transaction.commit();
  } catch (error) {
    await transaction.rollback();
    throw error;
  }
}
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**

- **–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å** - –ª–∏–±–æ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è, –ª–∏–±–æ –Ω–∏ –æ–¥–Ω–∞
- **–ò–∑–æ–ª—è—Ü–∏—è** - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –≤–∏–¥—è—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- **–ü–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞** - –ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø–∏—Å—å, –≤—Ç–æ—Ä–æ–π –∂–¥—ë—Ç

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**

- –û–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (–≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ) - —Å–ª–æ–∂–Ω–µ–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- Redis locks - –∏–∑–±—ã—Ç–æ—á–Ω–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î

**–ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –≥–æ–Ω–∫–µ:**

1. –ó–∞–ø—Ä–æ—Å 1 –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞—è–≤–∫—É ‚Üí –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –≤ `in_progress` ‚Üí –∫–æ–º–º–∏—Ç
2. –ó–∞–ø—Ä–æ—Å 2 –∂–¥—ë—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è ‚Üí –≤–∏–¥–∏—Ç —Å—Ç–∞—Ç—É—Å `in_progress` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `409 Conflict`

---

## 4. –°—Ç–∞—Ç—É—Å–Ω–∞—è –º–æ–¥–µ–ª—å –∑–∞—è–≤–∫–∏

**–†–µ—à–µ–Ω–∏–µ:** –ö–æ–Ω–µ—á–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç —Å 5 —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏

```
new ‚Üí assigned ‚Üí in_progress ‚Üí done
        ‚Üì            ‚Üì
     canceled    canceled
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**

- **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å** - —á—ë—Ç–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É —Å—Ç–∞—Ç—É—Å–∞–º–∏
- **–í–∞–ª–∏–¥–∞—Ü–∏—è** - –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –≤ –Ω–µ–≤–µ—Ä–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- **–ê—É–¥–∏—Ç** - –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —á–µ—Ä–µ–∑ `updatedAt`

**–ü—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤:**

```typescript
if (request.status !== "assigned") {
  throw new Error(`Cannot take in progress. Current status: ${request.status}`);
}
```

**–ó–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫:**

- –ù–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é –∑–∞—è–≤–∫—É
- –ù–µ–ª—å–∑—è –∑–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞—è–≤–∫—É, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –≤ —Ä–∞–±–æ—Ç–µ
- –ù–µ–ª—å–∑—è –≤–∑—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É –Ω–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—É—é –∑–∞—è–≤–∫—É

---

## 5. RESTful API –¥–∏–∑–∞–π–Ω

**–†–µ—à–µ–Ω–∏–µ:** REST-–ø–æ–¥—Ö–æ–¥ —Å —Å–µ–º–∞–Ω—Ç–∏—á–Ω—ã–º–∏ HTTP-–º–µ—Ç–æ–¥–∞–º–∏ –∏ –∫–æ–¥–∞–º–∏

```
POST   /api/requests              ‚Üí –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É (201)
GET    /api/requests?status=new   ‚Üí –°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ (200)
POST   /api/requests/assign       ‚Üí –ù–∞–∑–Ω–∞—á–∏—Ç—å –º–∞—Å—Ç–µ—Ä–∞ (200)
POST   /api/requests/:id/take     ‚Üí –í–∑—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É (200/409)
POST   /api/requests/:id/complete ‚Üí –ó–∞–≤–µ—Ä—à–∏—Ç—å (200/400)
POST   /api/requests/:id/cancel   ‚Üí –û—Ç–º–µ–Ω–∏—Ç—å (200/400)
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**

- **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è** - –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π API –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- **HTTP-–∫–æ–¥—ã** - `200` —É—Å–ø–µ—Ö, `400` –æ—à–∏–±–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞, `409` –∫–æ–Ω—Ñ–ª–∏–∫—Ç, `500` –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
- **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** - –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å –Ω–µ –º–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ

**–ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫:**

```typescript
if (error.message.includes("Current status")) {
  res.status(409).json({ error: error.message }); // –ö–æ–Ω—Ñ–ª–∏–∫—Ç
} else {
  res.status(400).json({ error: error.message }); // –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞
}
```

---

## 6. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π: –¥–∏—Å–ø–µ—Ç—á–µ—Ä vs –º–∞—Å—Ç–µ—Ä

**–†–µ—à–µ–Ω–∏–µ:** –î–≤–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏

| –†–æ–ª—å      | –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏                                           |
| --------- | ----------------------------------------------------- |
| –î–∏—Å–ø–µ—Ç—á–µ—Ä | –í–∏–¥–∏—Ç –≤—Å–µ –∑–∞—è–≤–∫–∏, –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –º–∞—Å—Ç–µ—Ä–æ–≤, –æ—Ç–º–µ–Ω—è–µ—Ç –∑–∞—è–≤–∫–∏ |
| –ú–∞—Å—Ç–µ—Ä    | –í–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞—è–≤–∫–∏, –±–µ—Ä—ë—Ç –≤ —Ä–∞–±–æ—Ç—É, –∑–∞–≤–µ—Ä—à–∞–µ—Ç   |

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**

- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –º–∞—Å—Ç–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –≤–∑—è—Ç—å —á—É–∂—É—é –∑–∞—è–≤–∫—É
- **UX** - –∫–∞–∂–¥–∞—è —Ä–æ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ä–æ–ª–∏ (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä, –∫–ª–∏–µ–Ω—Ç)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

```typescript
// –î–∏—Å–ø–µ—Ç—á–µ—Ä: –≤—Å–µ –∑–∞—è–≤–∫–∏
GET /api/requests

// –ú–∞—Å—Ç–µ—Ä: —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞—è–≤–∫–∏
GET /api/requests?assignedTo=2

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ —Å–µ—Ä–≤–∏—Å–µ
if (request.assignedTo !== masterId) {
  throw new Error("Request is not assigned to this master");
}
```

---

## 7. –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è MVP

**–†–µ—à–µ–Ω–∏–µ:** –í—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ dropdown –±–µ–∑ JWT/—Å–µ—Å—Å–∏–π

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**

- **–°–∫–æ—Ä–æ—Å—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏** - —Ñ–æ–∫—É—Å –Ω–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ, –∞ –Ω–µ –Ω–∞ auth
- **–õ–æ–∫–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** - –ø—Ä–æ–µ–∫—Ç –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏, –∞ –Ω–µ production
- **–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å** - –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –Ω–µ –Ω—É–∂–Ω–∞ –ø–æ–ª–Ω–∞—è auth

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

```html
<select id="masterSelect">
  <option value="2">–ú–∞—Å—Ç–µ—Ä –ü–µ—Ç—Ä</option>
  <option value="3">–ú–∞—Å—Ç–µ—Ä –°–µ—Ä–≥–µ–π</option>
</select>
```

**–ë—É–¥—É—â–µ–µ —É–ª—É—á—à–µ–Ω–∏–µ (–¥–ª—è production):**

```typescript
// JWT-—Ç–æ–∫–µ–Ω—ã
app.post("/api/auth/login", (req, res) => {
  const token = jwt.sign({ userId, role }, SECRET);
  res.json({ token });
});

// Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–∏
const requireRole = (role) => (req, res, next) => {
  if (req.user.role !== role) {
    return res.status(403).json({ error: "Forbidden" });
  }
  next();
};
```

---

## –í—ã–≤–æ–¥—ã

–≠—Ç–∏ —Ä–µ—à–µ–Ω–∏—è –ø–æ–∑–≤–æ–ª–∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å:

- ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ–µ** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–∑–∞—â–∏—Ç–∞ –æ—Ç race condition)
- ‚úÖ **–ü–æ–Ω—è—Ç–Ω–æ–µ** (RESTful API, —Å—Ç–∞—Ç—É—Å–Ω–∞—è –º–æ–¥–µ–ª—å)
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–µ** (—Å–ª–æ–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- ‚úÖ **–ë—ã—Å—Ç—Ä–æ –∑–∞–ø—É—Å–∫–∞–µ–º–æ–µ** (SQLite, –±–µ–∑ Docker)
